<H1 align="center">Battery safety controller (BSC)</H1>

<p align="center">Herzlichen Dank an alle <b>Sponsoren</b>, die das Projekt unterst√ºtzen. Zum Sponsoring geht es <a href="https://github.com/sponsors/shining-man" target=_blank>hier</a> :smiley:</p>

<p align="center">
  <a href="https://bsc-shop.com" target="_blank"><img src="https://github.com/user-attachments/assets/2a044a67-b0f3-4285-8d8b-3e64ffd7539f" height="68"/></a>
</p>

<!-- SPONSORS_START -->
<p align="center"><strong>Gold</strong></p><p align="center">
<a href="https://github.com/stlorenz" target=_blank><img src="https://avatars.githubusercontent.com/u/5159308?u=cebe9493a817115c63c2c23a00fdd0f5f256b225&v=4" height="58"/></a>
<a href="https://github.com/zippeliniot" target=_blank><img src="https://avatars.githubusercontent.com/u/75243184?u=efd3a6a21adc165643f928b79e498191e90ebd43&v=4" height="58"/></a>
</p>
<p align="center"><strong>Bronze</strong></p><p align="center">
<a href="https://github.com/a-wolter" target=_blank><img src="https://avatars.githubusercontent.com/u/13150781?u=7e4d945122ebbe34a31bb917a7735c666b62040d&v=4" height="58"/></a>
<a href="https://github.com/SlapJackNpNp" target=_blank><img src="https://avatars.githubusercontent.com/u/26175386?v=4" height="58"/></a>
<a href="https://github.com/tanelvakker" target=_blank><img src="https://avatars.githubusercontent.com/u/26738629?u=ba2c63272337da5fa8a5eda7472995d0b15795d6&v=4" height="58"/></a>
<a href="https://github.com/D3R-ST3FAN" target=_blank><img src="https://avatars.githubusercontent.com/u/30196271?v=4" height="58"/></a>
<a href="https://github.com/stxShadow" target=_blank><img src="https://avatars.githubusercontent.com/u/48672214?u=3a9f9e495c4bc28faf9f7486348216a592550433&v=4" height="58"/></a>
<a href="https://github.com/steirerman" target=_blank><img src="https://avatars.githubusercontent.com/u/49448230?u=1cfb45fd834c8cd939d3ac4d3fb3c07ffb9c2a8c&v=4" height="58"/></a>
<a href="https://github.com/myhacsint" target=_blank><img src="https://avatars.githubusercontent.com/u/111045655?u=908af7bf6d8071bcb5707437983329b694732577&v=4" height="58"/></a>
<a href="https://github.com/SladeTheLeveller" target=_blank><img src="https://avatars.githubusercontent.com/u/127076644?u=96cfedf0bba5aa3e61fc6741d73fceba56563eb6&v=4" height="58"/></a>
<a href="https://github.com/Metaworld82" target=_blank><img src="https://avatars.githubusercontent.com/u/156550945?u=0f06f37bcaa23d70651a913adb6d277d34eaeaaa&v=4" height="58"/></a>
<a href="https://github.com/golfer-fossy" target=_blank><img src="https://avatars.githubusercontent.com/u/175492267?u=d029b983a51288f7038ef3460a11aba6522c5d12&v=4" height="58"/></a>
</p>
<p align="center"><strong>Supporter</strong></p><p align="center">
<a href="https://github.com/Emilleopold" target=_blank><img src="https://avatars.githubusercontent.com/u/6137560?v=4" height="58"/></a>
<a href="https://github.com/Timon321" target=_blank><img src="https://avatars.githubusercontent.com/u/7792233?u=5830023fdc7fd4e21aba8246d70f2255d2e50a4b&v=4" height="58"/></a>
<a href="https://github.com/PatrickGoettsch" target=_blank><img src="https://avatars.githubusercontent.com/u/8688158?u=5a0d7247dfdb3cafd36a49e41a7e68f862e32dd0&v=4" height="58"/></a>
<a href="https://github.com/HJoost" target=_blank><img src="https://avatars.githubusercontent.com/u/13537894?v=4" height="58"/></a>
<a href="https://github.com/mmkeule" target=_blank><img src="https://avatars.githubusercontent.com/u/13866729?v=4" height="58"/></a>
<a href="https://github.com/jgatringer" target=_blank><img src="https://avatars.githubusercontent.com/u/14805417?u=656f266a33aac2bf74030d8e0b46271dc219e01e&v=4" height="58"/></a>
<a href="https://github.com/vo5tr0" target=_blank><img src="https://avatars.githubusercontent.com/u/14971935?v=4" height="58"/></a>
<a href="https://github.com/JoergWie" target=_blank><img src="https://avatars.githubusercontent.com/u/20060594?u=e2b4660646488d6b18034efcef9f3dbfc5dd5dac&v=4" height="58"/></a>
<a href="https://github.com/Vitalic66" target=_blank><img src="https://avatars.githubusercontent.com/u/26961054?u=a497667f7c97db8684b860299e3223fb0070c919&v=4" height="58"/></a>
<a href="https://github.com/oalbers58" target=_blank><img src="https://avatars.githubusercontent.com/u/45533193?v=4" height="58"/></a>
<a href="https://github.com/GadingeL" target=_blank><img src="https://avatars.githubusercontent.com/u/46995271?v=4" height="58"/></a>
<a href="https://github.com/michi1984" target=_blank><img src="https://avatars.githubusercontent.com/u/58638770?v=4" height="58"/></a>
<a href="https://github.com/pepe-el-pepe" target=_blank><img src="https://avatars.githubusercontent.com/u/61097309?u=217ffbae91308f3675269d8bae5ab11ddda7bfa7&v=4" height="58"/></a>
<a href="https://github.com/Ximerox" target=_blank><img src="https://avatars.githubusercontent.com/u/65176158?u=d1952cbd2fa94be247696e69ddd230cd9e950731&v=4" height="58"/></a>
<a href="https://github.com/SHendrik123" target=_blank><img src="https://avatars.githubusercontent.com/u/103681547?v=4" height="58"/></a>
<a href="https://github.com/gartenjoe" target=_blank><img src="https://avatars.githubusercontent.com/u/113258562?u=9a17d545201068adae93ae632985056122975fad&v=4" height="58"/></a>
<a href="https://github.com/KrawallOPA" target=_blank><img src="https://avatars.githubusercontent.com/u/115902005?v=4" height="58"/></a>
<a href="https://github.com/papala24" target=_blank><img src="https://avatars.githubusercontent.com/u/127226933?v=4" height="58"/></a>
<a href="https://github.com/Diedaa" target=_blank><img src="https://avatars.githubusercontent.com/u/175444581?u=72327f606d0cb2d7de9341b208a492090e0a0272&v=4" height="58"/></a>
<a href="https://github.com/mmoe-milano" target=_blank><img src="https://avatars.githubusercontent.com/u/177930080?v=4" height="58"/></a>
<a href="https://github.com/erwinh-at" target=_blank><img src="https://avatars.githubusercontent.com/u/195420064?v=4" height="58"/></a>
</p>
<!-- SPONSORS_ENDE -->

<p align="center">
  <img src="https://github.com/shining-man/bsc_fw/blob/main/doc/README_Dashboard.png"/>
</p>

The Battery Safety Controller (BSC) is a freely configurable controller that can be used for a wide range of control and monitoring tasks for DIY batteries. The BSC can take over the central control of the Energy-Sorange system and can be used to implement a second safety level in addition to the BMS.

The BSC consists of two components. The BSC hardware and the corresponding software.

1. The [BSC Hardware](https://github.com/shining-man/bsc_hw), which is used as middleware between the BMS and the inverter. One advantage of the BSC hardware is its secure operation. The components and design are such that all physical interfaces are galvanically isolated.

2. The BSC software, which makes the Battery Safety Controller hardware a freely configurable controller that can be used for a wide range of control and monitoring tasks in DIY battery systems.

The BSC software can also be used independently of the BSC hardware on ESP32 DevKit modules. In this case, for example, the NEEY balancer data can be transmitted to MQTT.

The BSC display can also be used for visualization.

## Use cases of the BSC
### 1. Monitoring of connected devices (serial, Bluetooth)
For this purpose, the BSC can send the data from the connected devices (BMS, balancer, temperature sensors) via MQTT to a broker to display them graphically with Grafana, for example, or to further process the data from an automation system (ioBroker, NodRed, Home Assistant, ...).

It is possible to use the VenusOS dbus driver ([dbus-bsc-can](https://github.com/shining-man/dbus-bsc-can)) to transfer the extended data (cell voltages, temperatures, ...) via the CAN bus to the Victron system.

### 2. Charge control
For this, the BSC takes the data from the connected devices to control the inverter (Victron, Solis, DEYE, ...) connected via the CAN bus. Here are several functions available to adapt the charge control to your own DIY battery.
- Cell voltage dependent throttling of the charge current
- Reduce charge current in case of cell drift
- SoC dependent charge current reduction
- Charge current cut-off: prevents continuous recharging when the battery is full
- Combining data from the individual physical battery packs into an overall virtual battery pack, with consideration of many parameters, such as can/does the battery pack charge/discharge at all.

### 3. Second safety level besides the BMS.
The BSC can monitor various configurable parameters on connected devices (serial, Bluetooth) to create a second level of security. <br>
Parameters that can be monitored include:
- Does the connected BMS respond regularly
- Cell voltages (min/max)
- Total voltage (min/max)
- Temperatures

This can be used, for example, to control the relay outputs to trigger a load break switch.

### 4. Temperature monitoring
Up to 64 OneWire temperature sensors (DS18B20) can be connected and monitored. There are different regulations for monitoring the temperature:
- Maximum value monitoring
- Maximum value monitoring with one sensor as reference value
- Differential value monitoring

All settings can be freely parameterized via a web interface. <br>
As an example a part of the Inverter Settings:<br>
![bsc_inverter_settings](https://github.com/shining-man/bsc_fw/blob/main/doc/README_inverter_settings.png?raw=true)

## Supported BMS (RS485)
- JBD (Jiabaida)
- JK
- Seplos, Seplos V3 [1]
- DALY
- Sylcin [1]
- Gobel [1]

[1]: With the Seplos and the Sylcin BMS, up to 8 devices can be connected to one serial port.

## Supported Inverter
- Victron
- Pylontech protocol (Solis, DEYE, ...)
- BYD protocol (only tested with SolarEdge RWS)

## Supported Bluetooth devices
- NEEY (up to 7 pieces) [2]
- JK-BMS (Test phase)

[2]: Special function: With the NEEY Balancer, not only can the data be read, it can also be configured via the BSC.

## Features der BSC-Hardware
* 6x Relay outputs
* 4x Digital inputs (isolated)
* 3x Serial interface (isolated) [3]
* Onewire (64x DS18B20)
* CAN (isolated)
* Bluetooth
* WLAN

[3]: With the [Serial Extension](https://github.com/shining-man/bsc_extension_serial) the BSC can be extended by 8 additional physical and galvanically isolated serial ports.

## First steps
A lot of further information about commissioning, supported devices, information about the WebUI can be found in the [Wiki](https://github.com/shining-man/bsc_fw/wiki).

### Use with an ESP32 DevKit
### GPIOs
Interface | RX | TX
-------- | -------- | --------
**Serial 0**   | GPIO 16   | GPIO 17
**Serial 1**   | GPIO 23   | GPIO 25
**Serial 2**   | GPIO 35   | GPIO 33
**CAN**   | GPIO 5   | GPIO 4

Further description can be found [here](https://github.com/shining-man/bsc_fw/wiki/40-BSC%E2%80%90Test-ohne-orig.-Hardware).

## More information
* [Discord Forum](https://discord.gg/WRUhegRPQn)
(The Discord is in German, but you can also write in English.
We are also happy to welcome members from other countries.)
* [Wiki - supported devices](https://github.com/shining-man/bsc_fw/wiki/Supported-devices)
* [Wiki (German)](https://github.com/shining-man/bsc_fw/wiki)
* [Discussions](https://github.com/shining-man/bsc_fw/discussions)
* [PCB](https://github.com/shining-man/bsc_hw)
* [Stromlaufplan](https://github.com/shining-man/bsc_hw/blob/main/circuit.pdf?raw=true "Stromlaufplan")


# Status display
To show the status of the BSC and the connected BMSes there is a status display for the BSC.<br>
More details are in the Github project of the display.
[GitHub project Display](https://github.com/shining-man/bsc_display)

<img src="https://github.com/user-attachments/assets/8db86295-1d72-4389-9650-80bd504366ac" height="400"/>

# VenusOS dbus driver
To display more data in VenusOS (Victron) like the cell voltages of the connected BMS or the temperatures of the OneWire sensors, there is a dbus driver. Here the data is not transmitted via WLAN to the VenusOS, but via the CAN bus. <br>
For more info see the github project: [dbus-bsc-can](https://github.com/shining-man/dbus-bsc-can)
