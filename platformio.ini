; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env]
test_framework = googletest
lib_deps =
  https://github.com/shining-man/ESP32-TWAI
  https://github.com/meikjaeckle/type_safe#platformio
  https://github.com/thingsboard/pubsubclient

build_flags =
  ;-L lib_precompiled
  -std=gnu++2a
  -std=gnu11
  -fexceptions

build_unflags =
  -std=gnu++11
  -std=gnu99
  -fno-exceptions


[env:native_test]
platform = native
test_framework = ${env.test_framework}
build_flags =
  ${env.build_flags}


; In case you want to run the unit tests in release mode
[env:native_test_release]
platform = native
test_framework = ${env.test_framework}
build_flags =
  ${env.build_flags}
  -DNDEBUG
build_unflags =
  ${env.build_unflags}
  -g


[env_bsc]  
extends = env 

platform = https://github.com/shining-man/platform-espressif32-t/releases/download/bsc_v1/platform-espressif32.zip ;2022.12.0
;platform = espressif32@~6.4.0
board = esp32dev
framework = arduino
test_framework = ${env.test_framework}
test_speed = 115200
;platform_packages = framework-arduinoespressif32 @ https://github.com/espressif/arduino-esp32.git#2.0.14
lib_deps =
	${env.lib_deps}
monitor_speed = 115200
monitor_filters =
	esp32_exception_decoder
	colorize
board_build.flash_size = 16MB
board_build.partitions = default_bsc.csv

; Debug
;debug_tool = esp-prog
;debug_init_break = tbreak setup
; Set optimization level and amount of debug information generated by the compiler
;debug_build_flags = -O0 -ggdb3 -g3

;upload_protocol = esp-prog
;upload_speed = 921600
;upload_port = COM6

build_src_filter =
  +<*>
  -<LEDController.cpp>
  -<LEDController.h>

extra_scripts =
	pre:scripts/prebuild_parameter.py
	;post:scripts/postbuild_bin.py
  ;post:scripts/log_build_output.py
	
build_flags =
  -D BSC_HW
  ${env.build_flags}
  ;-llibwebapp2
  -DBSC_SW_SPEZIAL="\"\""
  -DDEBUG_ON_FS
  -DLOG_LOCAL_LEVEL=ESP_LOG_DEBUG
  -DLOG_LOCAL_LEVEL_BSC=ESP_LOG_DEBUG
  -DCORE_DEBUG_LEVEL=1 ;1=Errors

build_unflags =
  ${env.build_unflags}
  -DDEBUG_ON_HW_SERIAL
 
 
[env:bsc]  
extends = env_bsc   
  
[env:bsc_en_US]  
extends = env_bsc    
extra_scripts =
  ${env_bsc.extra_scripts}  
	pre:scripts/params_lang.py
	pre:scripts/webpage_lang.py
build_flags =  
  ${env_bsc.build_flags}  
  -DBUILD_LANG="en_US"
  
[env:bsc_nl_NL]  
extends = env_bsc    
extra_scripts =
  ${env_bsc.extra_scripts}  
	pre:scripts/params_lang.py
	pre:scripts/webpage_lang.py
build_flags =  
  ${env_bsc.build_flags}  
  -DBUILD_LANG="nl_NL"


[env:bsc_hw_log]
platform = https://github.com/shining-man/platform-espressif32-t/releases/download/bsc_v1/platform-espressif32.zip ;2022.12.0
board = esp32dev
framework = arduino
test_framework = ${env.test_framework}
lib_deps =
	${env.lib_deps}
monitor_speed = 115200
monitor_filters =
	esp32_exception_decoder
	colorize
	;log2file
board_build.flash_size = 16MB
board_build.partitions = default_bsc.csv

build_src_filter =
  +<*>
  -<LEDController.cpp>
  -<LEDController.h>

extra_scripts =
	pre:scripts/prebuild_parameter.py
	;post:scripts/postbuild_bin.py

build_flags =
  -D BSC_HW
  ${env.build_flags}
  ;-llibwebapp2_serial_log
	-DBSC_SW_SPEZIAL="\"SERIAL_LOG\""
	-DDEBUG_ON_HW_SERIAL
	-DLOG_LOCAL_LEVEL=ESP_LOG_DEBUG
	-DLOG_LOCAL_LEVEL_BSC=ESP_LOG_DEBUG
	-DCORE_DEBUG_LEVEL=1 ;1=Errors
  ;-DCOMPILE_UNIX_TIME=$UNIX_TIME

build_unflags =
  ${env.build_unflags}
  -DDEBUG_ON_FS


[env:bsc_LILYGO_TCAN485]
platform = https://github.com/shining-man/platform-espressif32-t/releases/download/bsc_v1/platform-espressif32.zip ;2022.12.0
board = esp32dev
framework = arduino
lib_deps =
	${env.lib_deps}
  https://github.com/adafruit/Adafruit_NeoPixel
monitor_speed = 115200
monitor_filters =
	esp32_exception_decoder
	colorize
board_build.flash_size = 16MB
board_build.partitions = default_bsc.csv

build_src_filter =
  +<*>
  -<LEDController.cpp>
  -<LEDController.h>

extra_scripts =
	pre:scripts/prebuild_parameter.py
	;post:scripts/postbuild_bin.py

build_flags =
  ${env.build_flags}
  ;-llibwebapp2
  -DBSC_SW_SPEZIAL="\"\""
  -DLILYGO_TCAN485
  -DDEBUG_ON_FS
	;-DDEBUG_ON_HW_SERIAL
  -DLOG_LOCAL_LEVEL=ESP_LOG_DEBUG
  -DLOG_LOCAL_LEVEL_BSC=ESP_LOG_DEBUG
  -DCORE_DEBUG_LEVEL=1

build_unflags =
  ${env.build_unflags}
  -DDEBUG_ON_HW_SERIAL
  ;-DDEBUG_ON_FS


[env:bsc_LILYGO_TCAN485_UTEST]
platform = https://github.com/shining-man/platform-espressif32-t/releases/download/bsc_v1/platform-espressif32.zip ;2022.12.0
board = esp32dev
framework = arduino
lib_deps =
	${env.lib_deps}
  https://github.com/adafruit/Adafruit_NeoPixel
monitor_speed = 115200
monitor_filters =
	esp32_exception_decoder
	colorize
board_build.flash_size = 16MB
board_build.partitions = default_bsc.csv

build_src_filter =
  +<*>
  -<LEDController.cpp>
  -<LEDController.h>

extra_scripts =
	pre:scripts/prebuild_parameter.py
	;post:scripts/postbuild_bin.py

build_flags =
  ${env.build_flags}
  ;-llibwebapp2_serial_log
  -DBSC_SW_SPEZIAL="\"\""
  -DLILYGO_TCAN485
	-DDEBUG_ON_HW_SERIAL
  -DUTEST_RESTAPI
  -DLOG_LOCAL_LEVEL=ESP_LOG_DEBUG
  -DLOG_LOCAL_LEVEL_BSC=ESP_LOG_DEBUG
  -DCORE_DEBUG_LEVEL=1

build_unflags =
  ${env.build_unflags}
  -DDEBUG_ON_FS



[env_tconnect]  
extends = env 
boards_dir = ./boards

platform = espressif32 @6.5.0
board = esp32s3_flash_16MB
framework = arduino
test_framework = ${env.test_framework}
monitor_speed = 115200 ;Serial Baud Rate Setting

; debug_tool = esp-builtin
; upload_protocol = esp-builtin
upload_speed = 921600
monitor_filters =
	esp32_exception_decoder
	colorize

board_upload.flash_size = 16MB 

board_build.memory_type = qio_opi ;Enable internal PSRAM
; board_build.memory_type = qio_qspi ;Enable external PSRAM

board_build.partitions = default_16MB.csv 

lib_deps =
	${env.lib_deps}
  fastled/FastLED@^3.6.0

extra_scripts =
	pre:scripts/prebuild_parameter.py
  post:scripts/merge_bin_s3.py

build_flags = 
  ${env.build_flags}
  -D TCONNECT
  -D BSC_SW_SPEZIAL="\"Insider\""
  -D DEBUG_ON_FS

  ;-Wall ;all errors that everybody could agree on
  ;-Wextra ;somebody agree on
  ;-Werror ;Think of "Warning" as "Error".
  -D BOARD_HAS_PSRAM
  -D ARDUINO_USB_CDC_ON_BOOT=0 ;1 is to use the USB port as a serial port

  -D LOG_LOCAL_LEVEL=ESP_LOG_DEBUG
  -D LOG_LOCAL_LEVEL_BSC=ESP_LOG_DEBUG
  -D CORE_DEBUG_LEVEL=1 ;Debug level 0-5; 1=Errors

build_unflags =
  ${env.build_unflags}
  -D DEBUG_ON_HW_SERIAL
 
 
[env:bsc_TCONNECT_de_DE] 
extends = env_tconnect   
build_flags =  
  ${env_tconnect.build_flags}  
  -DBUILD_LANG="de_DE"
 
[env:bsc_TCONNECT_en_US] 
extends = env_tconnect   
build_flags =  
  ${env_tconnect.build_flags}  
  -DBUILD_LANG="en_US"
extra_scripts =
  ${env_tconnect.extra_scripts}  
	pre:scripts/params_lang.py
	pre:scripts/webpage_lang.py

 
[env:bsc_TCONNECT_nl_NL] 
extends = env_tconnect   
build_flags =  
  ${env_tconnect.build_flags}  
  -DBUILD_LANG="nl_NL"
extra_scripts =
  ${env_tconnect.extra_scripts}  
	pre:scripts/params_lang.py
	pre:scripts/webpage_lang.py
